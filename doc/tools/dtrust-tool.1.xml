<?xml version="1.0" encoding="UTF-8"?>
<refentry id="dtrust-tool">
	<refmeta>
		<refentrytitle>dtrust-tool</refentrytitle>
		<manvolnum>1</manvolnum>
		<refmiscinfo class="productname">OpenSC</refmiscinfo>
		<refmiscinfo class="manual">OpenSC Tools</refmiscinfo>
		<refmiscinfo class="source">opensc</refmiscinfo>
	</refmeta>

	<refnamediv>
		<refname>dtrust-tool</refname>
		<refpurpose>
			displays information about D-Trust signature cards and remove the transport protection
		</refpurpose>
	</refnamediv>

	<refsynopsisdiv>
		<cmdsynopsis>
			<command>dtrust-tool</command>
			<arg choice="opt"><replaceable class="option">OPTIONS</replaceable></arg>
		</cmdsynopsis>
	</refsynopsisdiv>

	<refsect1>
		<title>Description</title>
		<para>
			The <command>dtrust-tool</command> utility is used to display information about
			D-Trust signature cards and to remove the initial transport protection.
		</para>
	</refsect1>

	<refsect1>
		<title>Options</title>
		<para>
			<variablelist>
				<varlistentry>
					<term>
						<option>--reader</option> <replaceable>arg</replaceable>,
						<option>-r</option> <replaceable>arg</replaceable>
					</term>
					<listitem><para>
						Number of the reader to use. By default, the first reader with a
						present card is used. If <replaceable>arg</replaceable> is an ATR, the
						reader with a matching card will be chosen.
					</para></listitem>
				</varlistentry>
				<varlistentry>
					<term>
						<option>--wait</option>,
						<option>-w</option>
					</term>
					<listitem><para>
						Causes <command>dtrust-tool</command> to wait for the token to be
						inserted into reader.
					</para></listitem>
				</varlistentry>
				<varlistentry>
					<term>
						<option>--verify-can</option>,
					</term>
					<listitem>
						<para>
							D-Trust Card 5 comes with a Card Access Number (CAN) printed
							onto the card. The purpose of this number is to establish a
							secure communication channel between the card and the card
							reader. In normal operation <command>dtrust-tool</command>
							automatically prompts for the CAN.
						</para>
						<para>
							In case you entered a transport PIN wrong two times, the
							transport PIN becomes suspended. You need this parameter
							together with <option>--unlock-transport-protection</option> to
							resume the suspended transport PIN for a last attempt. Failing
							to enter the transport PIN successfully blocks the transport
							PIN. You then need to unblock the transport PIN with
							<option>--unblock-pin</option>.
						</para>
						<para>
							You may call <literal>dtrust-tool</literal> with just this
							option to save the CAN into the cache.
						</para>
					</listitem>
				</varlistentry>
				<varlistentry>
					<term>
						<option>--pin-status</option>,
						<option>-s</option>
					</term>
					<listitem><para>
						Show the status of the various PINs. The Card Holder PIN is used for
						advanced signatures and decryption. It is only defined for signature
						cards, but not for sealing cards. The signature PIN is used for
						qualified signatures. It can only be used if it is unlocked by
						presenting the Transport PIN. Once the Transport PIN is used, it cannot
						be used anymore. The PUK is used to unlock PIN which had beend entered
						incorrectly several times.
					</para></listitem>
				</varlistentry>
				<varlistentry>
					<term>
						<option>--check-transport-protection</option>,
						<option>-c</option>
					</term>
					<listitem>
						<para>
							In the delivery state the card is locked by a so called
							transport protection. This option allows to check if the
							transport protection is still in force. The Signature PIN can
							only be used if the transport protection is removed.
						</para>

						<para>
							Initially the transport protection should be intact. If you
							receive a new card and the transport protection was already
							broken, don't use that card and contact the producer for
							further advice.
						</para>

						<para>
							If you removed the transport protection, it is normal that
							<command>dtrust-tool</command> reports the transport protection
							as broken. This is the normal operation state. It does not mean
							your card is broken.
						</para>
					</listitem>
				</varlistentry>
				<varlistentry>
					<term>
						<option>--unlock-transport-protection</option>,
						<option>-u</option>
					</term>
					<listitem><para>
						This command removes the transport protection. It first queries the
						Transport PIN and then the new value of the Signature PIN twice.
					</para></listitem>
				</varlistentry>
				<varlistentry>
					<term>
						<option>--change-pin</option>,
					</term>
					<listitem>
						<para>
							Change the specified PIN. The following PINs can be changed:
						</para>
						<itemizedlist>
							<listitem>
								<para>For D-Trust Card 4: PIN.CH, PIN.QES, PUK.CH</para>
							</listitem>
							<listitem>
								<para>For D-Trust Card 5: PIN.QES, PIN.AUT, PUK.CH</para>
							</listitem>
						</itemizedlist>
						<para>
							It is not recommended to change the PUK.
						</para>
						<para>
							To change a PIN, you first have to enter the old PIN and then
							the new PIN value two times.
						</para>
					</listitem>
				</varlistentry>
				<varlistentry>
					<term>
						<option>--change-verify</option>,
					</term>
					<listitem><para>
						This option specifies the PIN to verify for changing the PIN
						specified with the <option>--change-pin</option> command. The only
						useful application of this option is to reset the cardholder PIN
						(PIN.CH) of D-Trust 4.1 cards by providing the cardholder PUK (PUK.CH).
						In all other cases, a PIN may only changed by providing its current
						value.
					</para></listitem>
				</varlistentry>
				<varlistentry>
					<term>
						<option>--resume-pin</option>,
					</term>
					<listitem>
						<para>
							Resume a suspended PIN. This matters only for the PUK (PUK.CH)
							of D-Trust 5 cards. After two unsuccessful attempts to verify
							the PUK, the PUK is suspended. To resume the suspended PUK you
							first have to input the CAN and then the value of the suspended
							PUK. If you enter the wrong PUK again, the PUK is finally
							blocked and cannot be recovered.
						</para>
						<para>
							To resume a suspended transport PIN use
							<option>--unlock-transport-protection</option> together with
							<option>--can</option>.
						</para>
					</listitem>
				</varlistentry>
				<varlistentry>
					<term>
						<option>--unblock-pin</option>,
					</term>
					<listitem>
						<para>
							Reset the retry counter of a PIN to its default value. To
							unblock a PIN, you first have to provide the PUK. The following
							PINs can be unblocked:
						</para>
						<itemizedlist>
							<listitem>
								<para>For D-Trust Card 4: PIN.T, PIN.CH, PIN.QES</para>
							</listitem>
							<listitem>
								<para>For D-Trust Card 5: PIN.T, PIN.T.AUT, PIN.QES, PIN.AUT</para>
							</listitem>
						</itemizedlist>
						<para>
							It is impossible to unblock a blocked PUK.
						</para>
						<para>
							Please keep in mind that the PUK may only be used a limited
							number of times (48 times for D-Trust Card 4 and 5).
						</para>
					</listitem>
				</varlistentry>
				<varlistentry>
					<term>
						<option>--help</option>,
						<option>-h</option>
					</term>
					<listitem><para>Print help message on screen.</para></listitem>
				</varlistentry>
				<varlistentry>
					<term>
						<option>--verbose</option>,
						<option>-v</option>
					</term>
					<listitem><para>
						Causes <command>dtrust-tool</command> to be more verbose. Specify this
						flag several times to enable debug output in the opensc library.
					</para></listitem>
				</varlistentry>
			</variablelist>
		</para>
	</refsect1>
	<refsect1>
		<title>Authors</title>
		<para><command>dtrust-tool</command> was written by
		Mario Haustein <email>mario.haustein@hrz.tu-chemnitz.de</email>.</para>
	</refsect1>
</refentry>
